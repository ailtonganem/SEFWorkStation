<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEFWorkStation</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 viewBox=%220 0 100 100%22><polygon points=%2250,15 100,85 0,85%22 style=%22fill:red;%22/></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Arial&display=swap" rel="stylesheet">

    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />

    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

    <link rel="stylesheet" href="style.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.1/showdown.min.js"></script>
    
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/pt-br.js'></script>

    <!-- NOVAS BIBLIOTECAS PARA EXPORTAÇÃO PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

</head>
<body class="bg-gray-100 dark:bg-slate-900">

    <div id="toast-notifications-container" class="fixed top-5 right-5 z-[10001] w-full max-w-xs space-y-3">
    </div>

    <header id="app-header">
        <div id="header-line-1" class="header-content-line">
            <button id="home-button" class="header-button btn-sef">
                <div class="red-triangle"></div>
                <span class="font-bold"><span class="text-red-600">SEF</span>WorkStation</span>
            </button>
            
            <div class="nav-scroll-container">
                <nav class="flex items-center"> 
                    <div id="primary-nav-items-container" class="flex items-center"> 
                        <!-- Menu Documentos -->
                        <div class="dropdown-container retractable-menu-item" data-dropdown-id="documentos-dropdown">
                            <button id="btn-documentos" class="header-button btn-documentos retractable-trigger" data-dropdown-trigger="documentos-dropdown">
                                <span class="menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                                </span>
                                <span class="menu-text">Documentos</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="ml-1 dropdown-arrow"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </button>
                            <div id="documentos-dropdown" class="dropdown-content">
                                <a href="#" data-action="novo-documento">Novo Documento</a>
                                <a href="#" data-action="gerir-documentos">Gerir Documentos</a>
                                <a href="#" data-action="criar-documentos-lote">Criar Documentos em Lote</a>
                                <a href="#" data-action="gerenciar-lotes-documentos">Gerenciar Lotes de Documentos</a>
                                <a href="#" data-action="gerenciar-modelos">Gerir Modelos</a>
                                <a href="#" data-action="gerenciar-tipos-documento">Gerir Tipos de Documento</a>
                                <a href="#" data-action="gerenciar-categorias-documento">Gerir Categorias</a>
                                <a href="#" data-action="gerenciar-tags-documento">Gerir Tags</a>
                            </div>
                        </div>

                        <!-- Menu Contribuintes -->
                        <div class="dropdown-container retractable-menu-item" data-dropdown-id="contribuintes-dropdown">
                            <button id="btn-contribuintes" class="header-button btn-contribuintes retractable-trigger" data-dropdown-trigger="contribuintes-dropdown">
                                <span class="menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                                </span>
                                <span class="menu-text">Contribuintes</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="ml-1 dropdown-arrow"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </button>
                            <div id="contribuintes-dropdown" class="dropdown-content">
                                <a href="#" data-action="novo-contribuinte">Novo Contribuinte</a>
                                <a href="#" data-action="gerir-contribuintes">Gerir Contribuintes</a>
                                <a href="#" data-action="gerir-categorias-contribuintes">Gerir Categorias de Contribuintes</a>
                                <a href="#" data-action="gerir-tags-contribuintes">Gerir Tags de Contribuintes</a>
                                <a href="#" data-action="gerir-contribuintes-placeholders">Gerir Placeholders de Contribuinte</a>
                                <a href="#" data-action="novo-recurso">Novo Recurso</a>
                                <a href="#" data-action="gerir-recursos">Gerir Recursos</a>
                            </div>
                        </div>

                        <!-- Menu Servidores -->
                        <div class="dropdown-container retractable-menu-item" data-dropdown-id="servidores-dropdown">
                            <button id="btn-servidores" class="header-button btn-servidores retractable-trigger" data-dropdown-trigger="servidores-dropdown">
                                <span class="menu-icon">
                                     <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                                </span>
                                <span class="menu-text">Servidores</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="ml-1 dropdown-arrow"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </button>
                            <div id="servidores-dropdown" class="dropdown-content">
                                <a href="#" data-action="novo-servidor">Novo Servidor</a>
                                <a href="#" data-action="gerir-servidores">Gerir Servidores</a>
                                <a href="#" data-action="gerir-grupos-servidores">Gerir Grupos de Servidores</a>
                                <a href="#" data-action="calendario-servidores">Calendário de Ausências</a>
                            </div>
                        </div>

                        <!-- Menu Processos -->
                        <div class="dropdown-container retractable-menu-item" data-dropdown-id="processos-dropdown">
                            <button id="btn-processos" class="header-button btn-processos retractable-trigger" data-dropdown-trigger="processos-dropdown">
                                <span class="menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>
                                </span>
                                <span class="menu-text">Processos</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="ml-1 dropdown-arrow"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </button>
                            <div id="processos-dropdown" class="dropdown-content">
                                <a href="#" data-action="cadastrar-protocolo">Cadastrar Protocolo</a>
                                <a href="#" data-action="gerir-protocolos">Gerir Protocolos</a>
                                <a href="#" data-action="cadastrar-pta">Cadastrar PTA</a>
                                <a href="#" data-action="gerir-ptas">Gerir PTAs</a>
                                <a href="#" data-action="cadastrar-autuacao">Cadastrar Autuação</a>
                                <a href="#" data-action="gerir-autuacoes">Gerir Autuações</a>
                            </div>
                        </div>
                        
                        <!-- Menu ITCD -->
                        <div class="dropdown-container retractable-menu-item" data-dropdown-id="itcd-dropdown">
                            <button id="btn-itcd" class="header-button btn-itcd retractable-trigger" data-dropdown-trigger="itcd-dropdown" style="background-color: #6c757d; color: white;">
                                <span class="menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M4 7V4a2 2 0 0 1 2-2h8.5L20 7.5V20a2 2 0 0 1-2-2H6a2 2 0 0 1-2-2v-3"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <path d="M5 10h1a2 2 0 0 1 2 2v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1a2 2 0 0 1 2-2z"></path>
                                    </svg>
                                </span>
                                <span class="menu-text">ITCD</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="ml-1 dropdown-arrow"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </button>
                            <div id="itcd-dropdown" class="dropdown-content">
                                <a href="#" data-action="itcd-calculo-hub">Cálculo de ITCD</a>
                                <a href="#" data-action="itcd-gerir-calculos">Gerir Cálculos Salvos</a>
                                <hr class="my-1 border-gray-200 dark:border-slate-600">
                                <a href="#" data-action="itcd-avaliar-imovel-urbano">Avaliação de Imóvel Urbano</a>
                                <a href="#" data-action="itcd-avaliar-imovel-rural">Avaliação de Imóvel Rural</a>
                                <a href="#" data-action="itcd-avaliar-semovente">Avaliação de Semovente</a>
                                <a href="#" data-action="itcd-pesquisar-veiculo-fipe">Pesquisa de Veículos (FIPE)</a>
                                <hr class="my-1 border-gray-200 dark:border-slate-600">
                                <a href="#" data-action="itcd-consultar-ufemg">Consultar UFEMG</a>
                                <a href="#" data-action="itcd-consultar-selic">Consultar SELIC</a>
                                <hr class="my-1 border-gray-200 dark:border-slate-600">
                                <a href="#" data-action="itcd-gerir-avaliacoes">Gerir Avaliações</a>
                                <a href="#" data-action="itcd-configuracoes">Configurações ITCD</a>
                            </div>
                        </div>

                        <!-- Menu Comunicação -->
                        <div class="dropdown-container retractable-menu-item" data-dropdown-id="comunicacao-dropdown">
                            <button id="btn-comunicacao" class="header-button btn-comunicacoes retractable-trigger" data-dropdown-trigger="comunicacao-dropdown">
                                <span class="menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                </span>
                                <span class="menu-text">Comunicação</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="ml-1 dropdown-arrow"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </button>
                            <div id="comunicacao-dropdown" class="dropdown-content">
                                <a href="#" data-action="escrever-email">Escrever Novo E-mail</a>
                                <a href="#" data-action="gerir-emails-criados">Gerir E-mails Criados</a>
                                <hr class="my-1 border-gray-200 dark:border-slate-600">
                                <a href="#" data-action="novo-destinatario">Novo Destinatário</a>
                                <a href="#" data-action="gerir-destinatarios">Gerir Destinatários</a>
                                <a href="#" data-action="novo-grupo-destinatarios">Novo Grupo de Destinatários</a>
                                <a href="#" data-action="gerir-grupos-destinatarios">Gerir Grupos de Destinatários</a>
                            </div>
                        </div>

                        <!-- Menu Tarefas -->
                        <div class="dropdown-container retractable-menu-item" data-dropdown-id="tarefas-dropdown">
                            <button id="btn-tarefas" class="header-button btn-tarefas retractable-trigger" data-dropdown-trigger="tarefas-dropdown">
                                <span class="menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
                                </span>
                                <span class="menu-text">Tarefas</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="ml-1 dropdown-arrow"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </button>
                            <div id="tarefas-dropdown" class="dropdown-content">
                                <a href="#" data-action="nova-tarefa">Nova Tarefa</a>
                                <a href="#" data-action="gerir-tarefas">Gerir Tarefas (Lista)</a>
                                <a href="#" data-action="calendario-tarefas">Gerir Tarefas (Calendário)</a>
                            </div>
                        </div>
                        
                        <!-- Menu Notas Rápidas -->
                        <div class="dropdown-container retractable-menu-item" data-dropdown-id="notas-rapidas-dropdown">
                            <button id="btn-notas-rapidas" class="header-button btn-notas retractable-trigger" data-dropdown-trigger="notas-rapidas-dropdown">
                                <span class="menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15.5 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z"></path><path d="M15 3v6h6"></path></svg>
                                </span>
                                <span class="menu-text">Notas Rápidas</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="ml-1 dropdown-arrow"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </button>
                            <div id="notas-rapidas-dropdown" class="dropdown-content">
                                <a href="#" data-action="nova-nota-rapida">Nova Nota Rápida</a>
                                <a href="#" data-action="gerir-notas-rapidas">Gerir Notas Rápidas</a>
                            </div>
                        </div>
                        
                        <!-- Menu Compartilhamento -->
                        <div class="dropdown-container retractable-menu-item" data-dropdown-id="compartilhamento-dropdown">
                            <button id="btn-compartilhamento" class="header-button btn-compartilhamento retractable-trigger" data-dropdown-trigger="compartilhamento-dropdown">
                                <span class="menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
                                </span>
                                <span class="menu-text">Compartilhamento</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="ml-1 dropdown-arrow"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </button>
                            <div id="compartilhamento-dropdown" class="dropdown-content">
                                <a href="#" data-action="central-compartilhamento">Central de Compartilhamento</a>
                                <a href="#" data-action="itens-recebidos">Itens Recebidos</a>
                            </div>
                        </div>

                        <!-- Menu Utilidades -->
                        <div class="dropdown-container retractable-menu-item" data-dropdown-id="utilidades-dropdown">
                            <button id="btn-utilidades" class="header-button btn-utilidades retractable-trigger" data-dropdown-trigger="utilidades-dropdown">
                                <span class="menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line></svg>
                                </span>
                                <span class="menu-text">Utilidades</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="ml-1 dropdown-arrow"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </button>
                            <div id="utilidades-dropdown" class="dropdown-content">
                                <a href="#" data-action="lixeira-global">Lixeira Global</a>
                                <a href="#" data-action="gerar-relatorios">Central de Relatórios</a>
                                <a href="#" data-action="gerenciar-anexos-central">Gerenciar Anexos</a>
                                <hr class="my-1 border-gray-200 dark:border-slate-600">
                                <a href="#" data-action="backup-restauracao-itcd">Backup / Restauração (Cálculos e Avaliações)</a>
                                <a href="#" data-action="fazer-backup">Backup / Restauração (Global ZIP)</a>
                                <a href="#" data-action="gerenciar-backups">Gerir Backups ZIP</a>
                                <hr class="my-1 border-gray-200 dark:border-slate-600">
                                <a href="#" data-action="salvar-base-dados">Salvar Base de Dados (.json)</a>
                                <a href="#" data-action="conversor-json-v2">Conversor de JSON (Sistema Antigo)</a>
                            </div>
                        </div>

                        <!-- Botão Ajuda -->
                        <div class="retractable-menu-item">
                            <button id="btn-ajuda" class="header-button btn-ajuda retractable-trigger" data-action="ajuda">
                                <span class="menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                                </span>
                                <span class="menu-text">Ajuda</span>
                            </button>
                        </div>
                    </div> 
                </nav>
            </div>

            <!-- CONTAINER PARA OS BOTÕES DA DIREITA -->
            <div id="header-right-actions" class="flex items-center ml-auto">
                <!-- Botão de Acesso Rápido Global -->
                <div class="dropdown-container">
                    <button id="btn-quick-access" class="header-button btn-quick-access" title="Acesso Rápido" data-dropdown-trigger="quick-access-dropdown">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                    <!-- CORREÇÃO: O conteúdo deste dropdown será preenchido dinamicamente pelo app.js -->
                    <div id="quick-access-dropdown" class="dropdown-content">
                        <!-- Conteúdo preenchido por JavaScript -->
                    </div>
                </div>

                <!-- Botão de Notificações -->
                <div class="dropdown-container">
                    <button id="btn-notifications" class="header-button" title="Notificações de Prazos" data-dropdown-trigger="notifications-dropdown">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-500">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <span id="notification-badge" class="notification-badge hidden">0</span>
                    </button>
                    <div id="notifications-dropdown" class="dropdown-content">
                        <!-- Conteúdo preenchido por JS -->
                    </div>
                </div>

                <!-- NOVO: Container do Menu de Usuário -->
                <div id="user-identity-display" class="dropdown-container">
                    <button id="btn-user-menu" class="header-button user-menu-button" data-dropdown-trigger="user-dropdown">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-circle mr-2 opacity-80" viewBox="0 0 16 16">
                            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                            <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
                        </svg>
                        <span id="user-menu-name" title="Usuário atual"></span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="ml-1 dropdown-arrow"><polyline points="6 9 12 15 18 9"></polyline></svg>
                    </button>
                    <div id="user-dropdown" class="dropdown-content">
                        <div class="px-3 py-2 border-b dark:border-slate-600">
                            <p id="user-dropdown-fullname" class="text-sm font-semibold text-gray-800 dark:text-gray-100 truncate"></p>
                            <p id="user-dropdown-email" class="text-xs text-gray-500 dark:text-gray-400 truncate"></p>
                        </div>
                        <a href="#" data-action="meu-perfil">Meu Perfil</a>
                        <a href="#" data-action="minhas-tarefas">Minhas Tarefas</a>
                        <a href="#" data-action="configuracoes">Configurações</a>
                        <hr class="my-1 border-gray-200 dark:border-slate-600">
                        <a href="#" data-action="mudar-usuario">Mudar de Usuário</a>
                    </div>
                </div>
                
                <button id="btn-theme-toggle" class="header-button btn-theme-toggle" title="Alternar Tema Claro/Escuro">
                    <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                    <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                </button>
                <button id="btn-contrast-toggle" class="header-button btn-contrast-toggle" title="Alternar Alto Contraste">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path></svg>
                </button>
            </div>
        </div>

        <div id="header-line-2" class="header-content-line header-secondary-line">
            <div class="search-container">
                <input type="search" id="global-search-input" placeholder="Pesquisar em toda a aplicação...">
                <button id="global-search-button" class="btn-primary" title="Buscar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/></svg>
                </button>
            </div>
            <div id="document-filters-container" class="filters-container">
                <div class="filter-item">
                    <label for="filter-tipo-select" class="sr-only">Filtrar por Tipo</label>
                    <select id="filter-tipo-select" class="header-filter-select">
                        <option value="">Todos os Tipos</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label for="filter-categoria-select" class="sr-only">Filtrar por Categoria</label>
                    <select id="filter-categoria-select" class="header-filter-select">
                        <option value="">Todas as Categorias</option>
                    </select>
                </div>
                 <div class="filter-item">
                    <label for="filter-tag-select" class="sr-only">Filtrar por Tag</label>
                    <select id="filter-tag-select" class="header-filter-select">
                        <option value="">Todas as Tags</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label for="filter-ordenacao-select" class="sr-only">Ordenar por</label>
                    <select id="filter-ordenacao-select" class="header-filter-select">
                        <option value="recentes">Mais Recentes</option>
                        <option value="antigos">Mais Antigos</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="header-line-3" class="header-content-line header-tertiary-line">
            <label for="quick-select-document" class="quick-select-label">Acesso Rápido:</label>
            <select id="quick-select-document" name="quick-select-document">
                <option value="">Selecione um documento para acesso rápido...</option>
            </select>
            <button id="btn-quick-save-db" class="header-button quick-action-button" title="Salvar Base de Dados (.json)">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-save-fill" viewBox="0 0 16 16">
                    <path d="M8.5 1.5A1.5 1.5 0 0 1 10 0h4a2 2 0 0 1 2 2v12a2 2 0 0 1-2-2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h6c-.314.418-.5.937-.5 1.5v6h-2a.5.5 0 0 0-.354.854l2.5 2.5a.5.5 0 0 0 .708 0l2.5-2.5A.5.5 0 0 0 10.5 7.5h-2v-6z"/>
                </svg>
                <span class="quick-action-button-text">Salvar DB</span>
            </button>
            <button id="btn-quick-restore-db" class="header-button quick-action-button" title="Restaurar Base de Dados de um arquivo .json" style="background-color: #ffc107; color: #212529;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-upload" viewBox="0 0 16 16">
                  <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                  <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
                </svg>
                <span class="quick-action-button-text">Restaurar DB</span>
            </button>
            <div id="update-notification-area" class="hidden items-center ml-4">
            </div>
        </div>

        <div id="header-line-4" class="header-content-line header-info-line">
            <span id="info-filtros-ativos" class="header-info-item">Filtros: Nenhum</span><span class="header-info-separator">|</span>
            <span id="info-total-documentos" class="header-info-item">Documentos: 0</span><span class="header-info-separator">|</span>
            <span id="info-backup-status" class="header-info-item">Backup ZIP: A verificar...</span>
            <span class="header-info-separator">|</span>
            <span id="info-sync-status" class="header-info-item">Sincronização: ...</span>
            <span class="header-info-separator">|</span>
            <span id="info-ls-status" class="header-info-item">LocalStorage: Verificando...</span>
            <span class="header-info-separator">|</span>
            <span id="info-db-status" class="header-info-item">IndexedDB: Verificando...</span>

            <span class="header-info-item app-name-info-line ml-auto"><span class="red-triangle-small"></span><span class="font-bold"><span class="text-red-600">SEF</span>WorkStation</span> <span id="app-version-display">vX.Y.Z</span></span><span class="header-info-separator">|</span> <span class="header-info-item">Desenvolvido por<span class="mx-1"></span> <a href="mailto:ailton.menezes@fazenda.mg.gov.br" class="link-email-dev">Ailton Ganem</a></span>
        </div>
    </header>

    <main id="main-page" class="container mx-auto mt-4">
        <div class="bg-white dark:bg-slate-800 text-black dark:text-white p-6 rounded-lg shadow main-content-wrapper">
            <div class="welcome-message-container">
                <h1 class="text-2xl font-semibold mb-4 text-gray-800 dark:text-gray-100">Bem-vindo ao <span class="text-red-600 font-bold">SEF</span>WorkStation!</h1>
                <div id="status-area"><p class="text-gray-600 dark:text-gray-300">A carregar aplicação...</p></div>
                <div id="feedback-area"></div>
            </div>
        </div>
    </main>

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <!-- Scripts Base da Aplicação -->
    <script src="js/preferences.js" defer></script>
    <script src="js/state.js" defer></script>
    <script src="js/db.js" defer></script>
    <script src="js/fileStorage.js" defer></script>
    <script src="js/entityConfig.js" defer></script>
    <script src="js/ui.js" defer></script>
    <script src="js/utils.js" defer></script>
    <script src="js/navigation.js" defer></script>
    <script src="js/backup.js" defer></script>
    <script src="js/filtros.js" defer></script>
    <script src="js/conversorJson.js" defer></script>
    <script src="js/configuracoes.js" defer></script>
    <script src="js/sharedUtils.js" defer></script>
    <script src="js/sharing.js" defer></script>
    <script src="js/itensCompartilhados.js" defer></script>
    <script src="js/sharingManager.js" defer></script> 
    <script src="js/globalSearch.js" defer></script>
    <script src="js/notifications.js" defer></script>
    <script src="js/anexosCentral.js" defer></script>
    <script src="js/dossieGenerator.js" defer></script> 

    <!-- Scripts de Módulos de Funcionalidade -->
    <script src="js/editorTexto.js" defer></script>

    <!-- Documentos -->
    <script src="js/documentosForm.js" defer></script>
    <script src="js/documentosView.js" defer></script>
    <script src="js/documentosListagens.js" defer></script>
    <script src="js/documentosLote.js" defer></script>
    <script src="js/documentosLoteListagens.js" defer></script>
    <script src="js/documentosTipos.js" defer></script>
    <script src="js/documentosCategorias.js" defer></script>
    <script src="js/documentosTags.js" defer></script>
    <script src="js/documentos.js" defer></script>

    <!-- Contribuintes -->
    <script src="js/contribuintesForm.js" defer></script>
    <script src="js/contribuintesView.js" defer></script>
    <script src="js/contribuintesListagens.js" defer></script>
    <script src="js/contribuintesPlaceholders.js" defer></script>
    <script src="js/contribuintesCategorias.js" defer></script>
    <script src="js/contribuintesTags.js" defer></script>
    <script src="js/contribuintes.js" defer></script>

    <!-- Servidores -->
    <script src="js/servidoresForm.js" defer></script>
    <script src="js/servidoresView.js" defer></script>
    <script src="js/servidoresListagens.js" defer></script>
    <script src="js/servidoresGruposForm.js" defer></script> 
    <script src="js/servidoresGruposListagens.js" defer></script> 
    <script src="js/servidoresGruposView.js" defer></script> 
    <script src="js/servidoresGrupos.js" defer></script>
    <script src="js/servidoresCalendario.js" defer></script>
    <script src="js/servidores.js" defer></script>
    
    <!-- Módulo ITCD (ORDEM DOS SUBMÓDULOS REVISADA E CORRIGIDA) -->
    <!-- Dependências Base do ITCD -->
    <script src="js/itcd/tabelasReferencia.js" defer></script>
    
    <!-- Sub-módulos de Configurações -->
    <script src="js/itcd/configuracoes/principal.js" defer></script>
    <script src="js/itcd/configuracoes/urbano.js" defer></script>
    <script src="js/itcd/configuracoes/rural.js" defer></script>
    <script src="js/itcd/configuracoes/semoventes.js" defer></script>
    <script src="js/itcd/configuracoes/partilha.js" defer></script>
    <script src="js/itcd/configuracoes/admin.js" defer></script>
    <script src="js/itcd/configuracoes.js" defer></script> 
    
    <!-- Sub-módulos de Avaliações -->
    <script src="js/itcd/avaliacoes/urbano.js" defer></script>
    <script src="js/itcd/avaliacoes/rural.js" defer></script>
    <script src="js/itcd/avaliacoes/semoventes.js" defer></script>
    <script src="js/itcd/listagens.js" defer></script>
    <script src="js/itcd/view.js" defer></script>
    
    <!-- Sub-módulos de Cálculo -->
    <script src="js/itcd/calculo/legislacao/lei6763_75.js" defer></script>
    <script src="js/itcd/calculo/legislacao/lei9752_89.js" defer></script>
    <script src="js/itcd/calculo/legislacao/lei12426_96.js" defer></script>
    <script src="js/itcd/calculo/legislacao/lei14941_03_ate2007.js" defer></script>
    <script src="js/itcd/calculo/legislacao/lei14941_03_apos2008.js" defer></script>
    <script src="js/itcd/calculo/sucessao.js" defer></script>
    <script src="js/itcd/calculo/diferencaPartilha.js" defer></script>
    <script src="js/itcd/calculo/hub.js" defer></script>
    <script src="js/itcd/calculo/listagens.js" defer></script>
    <script src="js/itcd/calculo/view.js" defer></script>
    
    <!-- Sub-módulos de Cálculo (Tipos Específicos) -->
    <script src="js/itcd/calculo/causaMortis.js" defer></script>
    <script src="js/itcd/calculo/doacao.js" defer></script>
    <script src="js/itcd/calculo/excedenteMeacao.js" defer></script>
    <script src="js/itcd/calculo/instituicaoUsufruto.js" defer></script>
    <script src="js/itcd/calculo/extincaoUsufruto.js" defer></script>
    <script src="js/itcd/calculo/doacoesSucessivas.js" defer></script>
    
    <!-- Orquestrador Principal do ITCD (Carregado APÓS todos os seus componentes) -->
    <script src="js/itcd.js" defer></script>

    <!-- Outros Módulos -->
    <script src="js/recursosForm.js" defer></script>
    <script src="js/recursosView.js" defer></script>
    <script src="js/recursosListagens.js" defer></script>
    <script src="js/recursos.js" defer></script>

    <script src="js/notasRapidasForm.js" defer></script>
    <script src="js/notasRapidasListagens.js" defer></script>
    <script src="js/notasRapidasView.js" defer></script>
    <script src="js/notasRapidas.js" defer></script>

    <script src="js/tarefasForm.js" defer></script>
    <script src="js/tarefasView.js" defer></script>
    <script src="js/tarefasListagens.js" defer></script>
    <script src="js/tarefasCalendario.js" defer></script>
    <script src="js/tarefas.js" defer></script>

    <script src="js/protocolosForm.js" defer></script>
    <script src="js/protocolosListagens.js" defer></script>
    <script src="js/protocolosView.js" defer></script>
    <script src="js/ptasForm.js" defer></script>
    <script src="js/ptasListagens.js" defer></script>
    <script src="js/ptasView.js" defer></script>
    <script src="js/autuacoesForm.js" defer></script>
    <script src="js/autuacoesListagens.js" defer></script>
    <script src="js/autuacoesView.js" defer></script>
    <script src="js/processos.js" defer></script>

    <!-- Módulos de Comunicação -->
    <script src="js/comunicacaoDestinatariosForm.js" defer></script>
    <script src="js/comunicacaoDestinatariosListagens.js" defer></script>
    <script src="js/comunicacaoDestinatariosView.js" defer></script> 
    <script src="js/comunicacaoDestinatarios.js" defer></script> 
    <script src="js/comunicacaoGruposForm.js" defer></script> 
    <script src="js/comunicacaoGruposListagens.js" defer></script> 
    <script src="js/comunicacaoGruposView.js" defer></script> 
    <script src="js/comunicacaoGrupos.js" defer></script> 
    <script src="js/comunicacaoEmailCompositor.js" defer></script>
    <script src="js/comunicacaoEmailVisualizacao.js" defer></script> 
    <script src="js/comunicacaoEmailsGeradosListagens.js" defer></script> 
    <script src="js/comunicacao.js" defer></script> 

    <script src="js/lixeiraGlobal.js" defer></script>
    
    <!-- Módulos da Ajuda e Manual -->
    <script src="js/ajudaConteudo.js" defer></script>
    <script src="js/manualDocumentos.js" defer></script> 
    <script src="js/manualContribuintes.js" defer></script>
    <script src="js/manualProcessos.js" defer></script>
    <script src="js/manualServidores.js" defer></script>
    <script src="js/manualItcd.js" defer></script>
    <script src="js/manualComunicacao.js" defer></script>
    <script src="js/manualTarefas.js" defer></script>
    <script src="js/manualNotasRapidas.js" defer></script>
    <script src="js/manualUtilidades.js" defer></script>
    <script src="js/manualConfiguracoes.js" defer></script> 
    <script src="js/manualCompartilhamento.js" defer></script>
    <script src="js/manualSolucaoProblemas.js" defer></script>
    <script src="js/manualDicasAvancadas.js" defer></script>
    <script src="js/manual.js" defer></script> 
    <script src="js/ajuda.js" defer></script>
    
    <script src="js/dashboardWidgetsServidores.js" defer></script>
    <script src="js/dashboard.js" defer></script>
    <script src="js/relatorios.js" defer></script> 
    
    <!-- Script Principal da Aplicação (DEVE SER O ÚLTIMO) -->
    <script src="js/app.js" defer></script>

</body>
</html>